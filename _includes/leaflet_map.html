<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.3.0/dist/MarkerCluster.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.3.0/dist/MarkerCluster.Default.css"/>
<script src="https://unpkg.com/leaflet.markercluster@1.3.0/dist/leaflet.markercluster.js"></script>
<div id="map-viewer" style="height:450px;border:1px solid grey;"></div>
<script>
  $.getJSON("{{ site.baseurl }}/js/map-markers.json", function(markers_json) {
    // map and tile layer
    window.map_viewer;
    map_viewer = L.map('map-viewer', {
      center: [{{ include.coordinates[0] }}],
      zoom: {{ include.zoom | default: 10 }}
    });
    L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/terrain-background/{z}/{x}/{y}.{ext}', {
    	attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
    	subdomains: 'abcd',
    	minZoom: 0,
    	maxZoom: 18,
    	ext: 'png'
    }).addTo(map_viewer);
    L.tileLayer('https://stamen-tiles-{s}.a.ssl.fastly.net/toner-labels/{z}/{x}/{y}.{ext}', {
      attribution: 'Map tiles by <a href="http://stamen.com">Stamen Design</a> &mdash; Map data &copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>',
      subdomains: 'abcd',
      minZoom: 0,
      maxZoom: 20,
      ext: 'png'
    }).addTo(map_viewer);

    // markers
    var markers = L.markerClusterGroup({spiderfyOnMaxZoom: true});
    for (i in markers_json){
      item = markers_json[i];
      var title = item['title'];
      var link = item['link'];
      var thumb = item['thumbnail'];
      var coordinates = item['coordinates'];
      for (c in coordinates){
        coordinate = coordinates[c].split(",");
        var marker = L.marker(coordinate);
        marker.bindPopup(
          '<a href="' + link + '">' + title + '<br><br><img src="' + thumb +'"/></a>'
        );
        markers.addLayer(marker);
      }
    }
    map_viewer.addLayer(markers);
  });
  $('.map-link').click(function(){
    var coordinate = $(this).attr('data-coordinate').split(",");
    console.log(coordinate);
    map_viewer.setView(coordinate, 12);
  });
</script>
